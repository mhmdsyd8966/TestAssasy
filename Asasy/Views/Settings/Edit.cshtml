@model Asasy.Domain.ViewModel.Settings.SettingEditViewModel

@{
    ViewData["Title"] = "Edit";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<style>
    .custom-map-control-button {
        position: absolute;
        top: 5px !important;
        width: 100px;
        padding: 12px 0;
        background: #007bff;
        color: #fff;
        font-size: 17px;
        border: none;
        border-radius: 7px;
    }

    .pac-target-input::placeholder {
        display: block;
        color: #000;
    }

    .gm-style-iw.gm-style-iw-c {
        color: green;
        font-weight: bold;
    }
</style>

<div class="card-box">
    <h2 class="header-title m-t-0 m-b-30" style="text-align:center">تعديل</h2>

    <div class="row justify-content-center">

        <div class="col-md-6">

            <form enctype="multipart/form-data" asp-action="Edit" method="post">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <input type="hidden" asp-for="Id" />
               @*  <input type="hidden" asp-for="Lat" />
                <input type="hidden" asp-for="Lng" />
                <input type="hidden" asp-for="Location" /> *@
                <div class="form-group">
                    <label asp-for="Phone" class="control-label">الهاتف</label>
                    <textarea asp-for="Phone" class="form-control"></textarea>
                    <span asp-validation-for="Phone" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Email" class="control-label">البريد الالكتروني</label>
                    <textarea asp-for="Email" class="form-control"></textarea>
                    <span asp-validation-for="Email" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="CondtionsArClient" class="control-label">الشروط والاحكام للعميل بالعربية</label>
                    <textarea asp-for="CondtionsArClient" class="form-control"></textarea>
                    <span asp-validation-for="CondtionsArClient" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="CondtionsEnClient" class="control-label">الشروط والاحكام للعميل بالانجليزية</label>
                    <textarea asp-for="CondtionsEnClient" class="form-control"></textarea>
                    <span asp-validation-for="CondtionsEnClient" class="text-danger"></span>
                </div>

               @*  <div class="form-group">
                    <label asp-for="CondtionsArDelegt" class="control-label">الشروط والاحكام لمقدم الخدمة بالعربية</label>
                    <textarea asp-for="CondtionsArDelegt" class="form-control"></textarea>
                    <span asp-validation-for="CondtionsArDelegt" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="CondtionsEnDelegt" class="control-label">الشروط والاحكام لمقدم الخدمة بالانجليزية</label>
                    <textarea asp-for="CondtionsEnDelegt" class="form-control"></textarea>
                    <span asp-validation-for="CondtionsEnDelegt" class="text-danger"></span>
                </div> *@


                <div class="form-group">
                    <label asp-for="FooterAr" class="control-label">الفقره بالعربيه</label>
                    <textarea asp-for="FooterAr" class="form-control"></textarea>
                    <span asp-validation-for="FooterAr" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="FooterEn" class="control-label">الفقره بالانجليزية</label>
                    <textarea asp-for="FooterEn" class="form-control"></textarea>
                    <span asp-validation-for="FooterEn" class="text-danger"></span>
                </div>


              @*   <div class="form-group">
                    <label asp-for="AboutUsArDelegt" class="control-label">من نحن لمقدم الخدمة بالعربية</label>
                    <textarea asp-for="AboutUsArDelegt" class="form-control"></textarea>
                    <span asp-validation-for="AboutUsArDelegt" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="AboutUsEnDelegt" class="control-label">من نحن لمقدم الخدمة بالانجليزية</label>
                    <textarea asp-for="AboutUsEnDelegt" class="form-control"></textarea>
                    <span asp-validation-for="AboutUsEnDelegt" class="text-danger"></span>
                </div> *@

                <div class="form-group">
                    <label asp-for="CommissionApp" class="control-label">عمولة التطبيق</label>
                    <input type="number" asp-for="CommissionApp" class="form-control" />
                    <span asp-validation-for="CommissionApp" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="PolicyAr" class="control-label">سياسه استخدام الخدمه بالعربيه</label>
                    <textarea asp-for="PolicyAr" class="form-control"></textarea>
                    <span asp-validation-for="PolicyAr" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="PolicyEn" class="control-label">سياسه استخدام الخدمه بالانجليزيه</label>
                    <textarea asp-for="PolicyEn" class="form-control"></textarea>
                    <span asp-validation-for="PolicyEn" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="DiscountSystemAr" class="control-label">نظام الخصم بالعربيه</label>
                    <textarea asp-for="DiscountSystemAr" class="form-control"></textarea>
                    <span asp-validation-for="DiscountSystemAr" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="DiscountSystemEn" class="control-label">نظام الخصم بالانجليزيه</label>
                    <textarea asp-for="DiscountSystemEn" class="form-control"></textarea>
                    <span asp-validation-for="DiscountSystemEn" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="ContactUsAr" class="control-label">نص تواصل معنا بالعربيه</label>
                    <textarea asp-for="ContactUsAr" class="form-control"></textarea>
                    <span asp-validation-for="ContactUsAr" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="ContactUsEn" class="control-label">نص تواصل معنا بالانجليزيه</label>
                    <textarea asp-for="ContactUsEn" class="form-control"></textarea>
                    <span asp-validation-for="ContactUsEn" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="SenderName" class="control-label">اسم المرسل للرسائل (SenderName)</label>
                    <textarea asp-for="SenderName" class="form-control"></textarea>
                    <span asp-validation-for="SenderName" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="UserNameSms" class="control-label">اسم المستخدم للرسائل (UserNameSms)</label>
                    <textarea asp-for="UserNameSms" class="form-control"></textarea>
                    <span asp-validation-for="UserNameSms" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="PasswordSms" class="control-label">كلمة المرور للسرائل (PasswordSms)</label>
                    <textarea asp-for="PasswordSms" class="form-control"></textarea>
                    <span asp-validation-for="PasswordSms" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="ApplicationId" class="control-label">رقم التطبيق (ApplicationId)</label>
                    <textarea asp-for="ApplicationId" class="form-control"></textarea>
                    <span asp-validation-for="ApplicationId" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="SenderId" class="control-label">رقم المرسل (SenderId)</label>
                    <textarea asp-for="SenderId" class="form-control"></textarea>
                    <span asp-validation-for="SenderId" class="text-danger"></span>
                </div>

@*                <div class="form-group">
                    <label asp-for="Address" class="control-label"> الموقع</label>
                    <div class="form-group">
                        <input asp-for="Address" class="form-control" />
                    </div>
                    <div id="map" style="width:100%; height:400px"></div>
                </div>
*@

                <div class="form-group relative-parent current-loc">
                    <div class="main-input-cont mb-3 map-inp">
                        <label asp-for="Location" class="control-label"> الموقع</label>
                        <div class="form-group">

                            <input asp-for="Location"
                                   type="text"
                                   class="main-input form-control"
                                   readonly
                                   id="address"
                                   name="Location"
                                   placeholder="يرجي تحديد العنوان علي الخريطة" />
                            <div class="main-float gray-col map-icon">
                                <i class="fa-solid fa-location-dot"></i>
                            </div>
                            <input type="hidden" asp-for="Lat" name="lat" id="lat"  />
                            <input type="hidden" asp-for="Lng" name="lng" id="lng"  />
                        </div>
                    </div>
                    <span asp-validation-for="Location" class="text-danger"></span>
                    <div class="container-map">
                        <div class="main-input-cont mb-3 sear-in col-md-6 col-12 p-0">
                            <input type="text"
                                   class="main-input form-control"
                                   name="address2"
                                   id="address2"
                                   placeholder="ابحث هنا" />
                        </div>
                        <div id="map"
                             class="mb-3"
                             style="width: 100%; height: 300px"></div>
                    </div>
                </div>
                <div class="form-group">
                    <input type="submit" value="حفظ" class="btn-new-style btn-rounded" />
                </div>
            </form>
        </div>
    </div>
</div>



@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");


        <script src="https://maps.google.com/maps/api/js?&libraries=places&key=AIzaSyBNLoYGrbnQI_GMqHt6m0PSN9yA7Zvq7gA&callback=initMap&language=ar"></script>
        <script src="~/js/locationpicker.jquery.js"></script>
        <script>
            var map, infoWindow;
            var marker;
            var lat = document.getElementById("lat");
            var lng = document.getElementById("lng");
            var address = document.getElementById("address");
            var address2 = document.getElementById("address2");
            var geocoder = new google.maps.Geocoder();
            var infowindow = new google.maps.InfoWindow();

            setTimeout(function () {
                if (document.querySelector(".current-loc")) {

                    console.log('current location is working')

                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            (position) => {
                              
                                const pos = {
                                    lat: parseFloat($("#lat").val()),
                                    lng: parseFloat($("#lng").val()),
                                };

                                console.log(pos)

                                infoWindow.setPosition(pos);
                                infoWindow.setContent("Location found.");
                                infoWindow.open(map);
                                map.setCenter(pos);
                                lat.value = pos.lat;
                                lng.value = pos.lng;
                                initMap();
                                console.log(marker.position.lat());
                                console.log(marker.position.lng());
                                console.log(pos.lat);
                            },
                            () => {
                                handleLocationError(true, infoWindow, map.getCenter());
                            }
                        );
                    } else {
                        // Browser doesn't support Geolocation
                        handleLocationError(false, infoWindow, map.getCenter());
                        console.log("sssssssssss")
                    }

                }
            }, 500)

            function initMap() {
                var myLatlng = new google.maps.LatLng(lat.value, lng.value);
                var mapOptions = {
                    zoom: 10,
                    center: myLatlng,
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                };

                map = new google.maps.Map(document.getElementById("map"), mapOptions);
                marker = new google.maps.Marker({
                    map: map,
                    position: myLatlng,
                    draggable: true,
                });

                // set current location
                infoWindow = new google.maps.InfoWindow();

                const locationButton = document.createElement("button");
                locationButton.setAttribute("type", "button");
                locationButton.classList.add("up", "default-font");

                locationButton.textContent = "موقعك الحالي";
                locationButton.classList.add("custom-map-control-button");
                map.controls[google.maps.ControlPosition.TOP_CENTER].push(
                    locationButton
                );
                //test get current location onload

                locationButton.addEventListener("click", () => {
                    // Try HTML5 geolocation.

                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            (position) => {
                                const pos = {
                                    lat: position.coords.latitude,
                                    lng: position.coords.longitude,
                                };

                                infoWindow.setPosition(pos);
                                infoWindow.setContent("Location found.");
                                infoWindow.open(map);
                                map.setCenter(pos);
                                lat.value = pos.lat;
                                lng.value = pos.lng;
                                initMap();
                                console.log(marker.position.lat());
                                console.log(marker.position.lng());
                                console.log(pos.lat);
                            },
                            () => {
                                handleLocationError(true, infoWindow, map.getCenter());
                            }
                        );
                    } else {
                        // Browser doesn't support Geolocation
                        handleLocationError(false, infoWindow, map.getCenter());
                    }
                });

                function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                    infoWindow.setPosition(pos);
                    infoWindow.setContent(
                        browserHasGeolocation
                            ? "Error: The Geolocation service failed."
                            : "Error: Your browser doesn't support geolocation."
                    );
                    infoWindow.open(map);
                }
                // end current location code
                // if(document.querySelector('.current-loc') && !document.querySelector('.current-loc')){
                // locationButton.click()
                // }

                geocoder.geocode({ latLng: myLatlng }, function (results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        if (results[0]) {
                            address.value = results[0].formatted_address;
                            lat.value = marker.getPosition().lat();
                            lng.value = marker.getPosition().lng();
                            infowindow.setContent(results[0].formatted_address);
                            infowindow.open(map, marker);


                        }
                    }
                });

                google.maps.event.addListener(marker, "dragend", function () {
                    geocoder.geocode(
                        { latLng: marker.getPosition() },
                        function (results, status) {
                            if (status == google.maps.GeocoderStatus.OK) {
                                if (results[0]) {
                                    address.value = results[0].formatted_address;
                                    lat.value = marker.getPosition().lat();
                                    lng.value = marker.getPosition().lng();
                                    infowindow.setContent(results[0].formatted_address);
                                    infowindow.open(map, marker);


                                }
                            }
                        }
                    );
                });
            }

            function initialize() {
                var input = document.getElementById("address2");
                var autocomplete = new google.maps.places.Autocomplete(
                    /* type {HTMLInputElement} */(input),
                    {
                        types: ["(cities)"],
                    }
                );
                google.maps.event.addListener(
                    autocomplete,
                    "place_changed",
                    function () {
                        var place = autocomplete.getPlace();
                        if (!place.geometry) {
                            return;
                        }
                        lat.value = place.geometry.location.lat();
                        lng.value = place.geometry.location.lng();
                        // initMap();
                        var address = "";
                        if (place.address_components) {
                            address = [
                                (place.address_components[0] &&
                                    place.address_components[0].short_name) ||
                                "",
                                (place.address_components[1] &&
                                    place.address_components[1].short_name) ||
                                "",
                                (place.address_components[2] &&
                                    place.address_components[2].short_name) ||
                                "",
                            ].join(" ");
                        }
                        initMap();

                    }
                );
            }

            google.maps.event.addDomListener(window, "load", initialize);

            google.maps.event.addDomListener(window, "load", initMap);

                    // show and hide map
                    // let mapbtn = document.querySelector(".map-inp");
                    // $(".container-map").hide();
                    // mapbtn.addEventListener("click", function () {
                    //     $(".container-map").slideToggle();
                    // });
        </script>
    }

@*    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBNm7VC4eQsCZcny5cVteIkg_SMJpc2G7Y&callback=initMap&language=ar"></script>
    <script src="~/js/locationpicker.jquery.js"></script>

    <script>
        $( document ).ready(function() {
                    var latlng = new google.maps.LatLng(@Model.Lat, @Model.Lng);
                    var map = new google.maps.Map(document.getElementById('map'), {
                        center: latlng,
                        zoom: 11,
                        mapTypeId: google.maps.MapTypeId.ROADMAP,
                        disableDefaultUI: true,
                        animation: google.maps.Animation.DROP,
                    });
                    var marker = new google.maps.Marker({
                        position: latlng,
                        map: map,
                        draggable: true
                    });
                    $('#map').locationpicker({
                    location: {
                        latitude: @Model.Lat,
                        longitude: @Model.Lng
                    },
                    //locationName: "",
                    radius: 50,
                    zoom: 15,
                    inputBinding: {
                        latitudeInput: $("#Lat"),
                        longitudeInput: $("#Lng"),
                        locationNameInput: $('#Address'),
                    },
                     enableAutocomplete: true
                });


                google.maps.event.addListener(marker, 'dragend', function (event) {
                   var  x = this.getPosition().lat();
                   var  y = this.getPosition().lng();
                   
                });
                });

    </script>
*@}
